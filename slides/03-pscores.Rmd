---
title: "Propensity Scores"
author: "Lucy D'Agostino McGowan"
institute: "Wake Forest University"
date: "2016/12/12 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    css: ["default", "lucy", "lucy-fonts", "my.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      highlightSpans: true
      countIncrementalSlides: false
---

## Observational Studies

**Goal**: To answer a research question

![](img/obs-studies.png)

---

## Observational Studies

**Goal**: To answer a research question

![](img/obs-studies-2.png)

---

## ~~Observational Studies~~
### **Randomized Controlled Trial**

![](img/randomized.png)

---

## ~~Observational Studies~~
### **Randomized Controlled Trial**

![](img/randomized-2.png)

---

## Observational Studies

![](img/obs-studies-3.png)

---

![](img/trt.png)

---

![](img/trt-conf.png)
---

## Confounding

![](img/conf-2.png)

---

## Confounding

![](img/conf-3.png)

---

## Propensity scores

Rosenbaum and Rubin showed in observational studies, conditioning on **propensity scores** can lead to unbiased estimates of the exposure effect

1. There are no unmeasured confounders
2. Every subject has a nonzero probability of receiving either exposure

---

## Propensity scores

* Fit a **logistic regression** predicting exposure using known covariates

$$Pr(exposure = 1) = \frac{1}{1+\exp(-X\beta)}$$

* Each individuals' predicted values are the **propensity scores**

---

## Propensity scores

```{r, message = FALSE, warning = FALSE}
library(tidyverse)
library(broom)
```

---

## Propensity scores

```{r, eval = FALSE}
glm(exposure ~ confounder_1 + confounder_2 + confounder_3 + ..., 
    data = df,
    family = binomial())
```

---

## Propensity scores

```{r, eval = FALSE}
glm(exposure ~ confounder_1 + confounder_2 + confounder_3 + ..., 
    data = df,
    family = binomial()) %>%
  augment(type.predict = "response", data = df) 
```

---

## Propensity scores

```{r, eval = FALSE}
glm(exposure ~ confounder_1 + confounder_2 + confounder_3 + ..., 
    data = df,
    family = binomial()) %>%
  augment(type.predict = "response", data = df) #<<
```

---

## Propensity scores

![](img/pscores.png)

---

## Your turn




